{% extends "base_form.html" %}

{% from "_render_grid_field.html" import render_field %}


{% block main__header %}
<header class="main__header">
<div class="header--mgt">
<h1>{{ title }}</h1>
</div>
</header>
{% endblock main__header %}

{% block main__content %}

<form method="POST" action="{{ url_for('manage.add_band', stage=4) }}">
    {% if stage == 4  %}

        {{ form.hidden_tag() }}
    <div class="form-header">
     <h1>{{ bname }}</h1>
    </div>
    <fieldset class="half">
        <legend>Promotion</legend>
        {{ render_field(form.featured_video) }}
        {{ render_field(form.contact_details.contact_name) }}
        {{ render_field(form.contact_details.contact_title) }}
        {{ render_field(form.contact_details.contact_emails.email_title) }}
        {{ render_field(form.contact_details.contact_emails.email_address) }}
        <ul id="contact_details-contact_numbers-mobile">
            <li><input id="contact_details-contact_numbers-mobile-0" name="contact_details-contact_numbers-mobile" type="radio" {{ 'checked' if form.contact_details.contact_numbers.mobile.data!=0 else '' }} value=1> <label for="contact_details-contact_numbers-mobile-0">mobile</label></li>
            <li><input id="contact_details-contact_numbers-mobile-1" name="contact_details-contact_numbers-mobile" type="radio" {{ 'checked' if form.contact_details.contact_numbers.mobile.data==0 else '' }} value=0> <label for="contact_details-contact_numbers-mobile-1">landline</label></li>
        </ul>
        {{ render_field(form.contact_details.contact_numbers.region) }}
        {{ render_field(form.contact_details.contact_numbers.phone) }}
    </fieldset>
    <div class="form-footer">
        <button class="btn btn-primary" id="submittion" type="submit">Next</button>
    </div>
    {% endif %}
</form>
<hr>
    {% if form.errors %}
            {{ form.errors }}
        {% endif %}
    {% if data is defined %}
            <p>Received data: {{ data }}</p>
        {% endif %}

{% endblock main__content %}

{% block form__footer %}
<footer class="form__footer">
<p>footer stuff</p>
</footer>
{% endblock form__footer %}

{% block javascript %}

{% assets "org_band_js" %}
<script src="{{ ASSET_URL }}" ></script>
{% endassets %}    

    <script>

    // individual ids 
    var wtf_phone_field = document.getElementById('contact_details-contact_numbers-phone');
    wtf_phone_field.style.position = 'absolute';
    wtf_phone_field.style.top = '-9999px';
    wtf_phone_field.style.left = '-9999px';
    wtf_phone_field.parentElement.insertAdjacentHTML('beforeend', '<div><span style="font-size:.8em;">Phone Number:</span><input type="tel" id="_phone"></div>');
    var fancy_phone_field = document.getElementById('_phone');
    var fancy_phone_iti = window.intlTelInput(fancy_phone_field, {
        initialCountry:"ie",
        preferredCountries: ["ie","gb", "fr", "nl", "de", "es", "us" ],
        //separateDialCode: true,
        nationalMode: true,
        utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/16.0.4/js/utils.js",
    });    
    fancy_phone_iti.setNumber(wtf_phone_field.value);
    fancy_phone_field.addEventListener('blur', function() {
        if(checkRegionState()){
            wtf_phone_field.value = fancy_phone_iti.getNumber();
        }else{
            wtf_phone_field.value = fancy_phone_field.value
        }
    }); 

    function checkRegionState(){
    let radios = document.querySelectorAll("#contact_details-contact_numbers-region input[type=radio]")
    let i = radios.length - 1
    if (radios[i].checked && radios[i].value == "None") {
        document.querySelector(".iti__flag-container").classList.remove("hide")
        return true
    }else{
        
        document.querySelector(".iti__flag-container").classList.add("hide")
        return false
    }
    }

    document.querySelectorAll("#contact_details-contact_numbers-region input[type=radio]").forEach( el => el.addEventListener("click", checkRegionState));

    document.addEventListener("DOMContentLoaded", function(){
    checkRegionState()
    })
    </script>

{% endblock javascript %}