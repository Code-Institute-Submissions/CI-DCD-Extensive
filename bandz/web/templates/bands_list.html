{% extends "base.html" %}
{% from "_render_pages_nav.html" import render_pages_nav %}
<!-- MAIN HEADER -->
{% block main__header %}
<header class="header--main">


{% if alphabet %}
<div class="wrapper__alphabet wrapper__alphabet--top">
<nav class="pages__pagelinks">
{% include "include_breadcrumbs.html" %}
    <ul class="pages__pagelinks__left--alphabet">
        {% for beta in alphabet %}
        <li><a class="btn {{ 'btn--pagelink--current' if beta == letter }}" href="/a-z/{{beta}}?page=1">{{ beta }}</a></li>
        {% endfor %}
    </ul>
{% if closest_letters %}
<h1 class="headline--alphabet">No Bands <small>starting with</small> {{ letter|upper }}!</h1>
{% else %}
<h1 class="headline--alphabet">Bands <small>starting with</small> {{ letter|upper }}<br><span class="headline--strapline">in alphabetical order</span></h1>
{% endif %}
{# {{ render_pages_nav(bands, 'public.a2z', letter) }} #}
</nav>
</div>
{% else %}
{% include "include_breadcrumbs.html" %}
<h1 class="headline headline--solo">Bands Listing</h1>
<nav class="pages__pagelinks pages__pagelinks--below">
{{ render_pages_nav(bands, 'public.results', None, search) }}
</nav>
{% endif %}

</header>
{% endblock main__header %}
<!-- CONTENT -->
{% block main__content %}

{% if closest_letters %}
<div class="content-block center">
<p>The closest alphabetical listings are start at:</p>
<span class="wide"><p><span class="btn btn--pagelink"><a href="/a-z/{{ closest_letters[0] }}?page=1">&laquo; {{closest_letters[0]|upper }}</a></span> and 
<span class="btn btn--pagelink"><a href="/a-z/{{ closest_letters[1] }}?page=1">{{ closest_letters[1]|upper }} &raquo;</a></span></p></span>
<p>Does your Band start with <b>{{ letter|upper }}</b> ?</p>
<p><a href="{{ url_for('user.register') }}">Sign up</a> today and add your band profile.</p>
</div>
{% else %}


{% for band in (bands.items if bands.items else bands) %} {# mongoengine queryset objects or pymong cursor (aggregations) #}
<div class="card {{ 'centerize-card' if bands_total == 1}}">
    <div class="card-img" style="background-image: url({{ url_for('static_media', filename='band_profile_pics/'+band.media_assets.featured_image if band.media_assets else 'band_profile_pics/defaultband.jpg' ) }})">
    <a href="{{ url_for('public.band_detail', bname=band.band_name, letter=letter if letter)}}"></a>
    </div>
    <div class="card-content">
        <p class="headline-eyebrow">{{ band.description }}</p>    
        <h2 class="headline"><a href="{{ url_for('public.band_detail', bname=band.band_name, letter=letter if letter)}}">{{ band.band_name }}</a></h2>
        <p class="headline--strapline">{{ band.strapline }}</p>
        <p>{{ band.profile|truncate(80, False) }}</p>
        <p>{{ band.hometown.town }}, Co.{{ band.hometown.county }}</p>
        <ul class="genre-tags">
            {% for genre in band.genres[0:4] %}
            <li>{{ genre }}</li>
            {% endfor %}
        </ul>
        <div class="card-footer">
            <ul>
                <li><a href="{{ url_for('public.band_detail', bname=band.band_name, letter=letter if letter )}}" class="btn btn-subform add">More Info</a></li>
            {% if current_user.is_authenticated %} {# and OWNS bands = session ? #}
                <li class="edit"><a href="{{ url_for('manage.update_band_profile', bname=band.band_name ) }}" class="btn btn-subform add">Edit</a></li>
            {% else %}

            {% endif %}
            </ul>
        </div>
    </div>
</div>
{% endfor %}
{% endif %}
{# {% for dict_item in request.args %} #}
<div class="search-params">
<hr>
<h3>{{ count }}</h3>
   {% for key, value in request.args.items() %}
      <h1>Key: {{key}}</h1>
      <h2>Value: {{value}}</h2>
   {% endfor %}

{{ search }}
</div>
{% endblock main__content %}
<!-- MAIN FOOTER -->
{% block main__footer %}
<footer class="footer--main pages">
{% if not closest_letters %}
    {% if bands.pages > 1 %}
        <nav class="pages__pagelinks">
        {% if alphabet %}
        {{ render_pages_nav(bands, 'public.a2z', letter) }}
        <div class="wrapper__alphabet wrapper__alphabet--bottom">
        <ul class="pages__pagelinks__left--alphabet">
            {% for beta in alphabet %}
            <li><a class="btn {{ 'btn--pagelink--current' if beta == letter }}" href="{{ url_for('public.a2z', letter=beta, page=1 ) }}">{{ beta }}</a></li>
            {% endfor %}
        </ul>
        </div>
        {% else %}
        {{ render_pages_nav(bands, 'public.results', None, search) }}
        {% endif %}
        </nav>
    {% endif %}
{% endif %}
</footer>
{% endblock main__footer %}